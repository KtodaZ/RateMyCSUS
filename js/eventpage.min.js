chrome.runtime.onMessage.addListener(function(a,b,c){var d=new XMLHttpRequest;return chrome.pageAction.show(b.tab.id),d.open("GET",a.url,!0),d.onerror=function(){c()},d.onreadystatechange=function(){function k(a,b){try{return document.evaluate(b,a,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue.textContent}catch(a){a instanceof TypeError&&(console.error("Null/ TypeError Caught, returning null"),c("No Ratings")),console.error("Error found "+a.message),c()}}var b=a.debug;if(4==d.readyState){var e=d.responseText,f=document.createElement("html");if(f.innerHTML=e,0===a.step){var g=$("a[href^='/ShowRatings.jsp?tid=']",f);if(console.dir(g),1===g.length)if(void 0!=g[0].search){var h="http://www.ratemyprofessors.com/ShowRatings.jsp"+g[0].search;console.log("Professor Link found: "+h),c(h)}else console.error("Professor Link undefined for url: "+a.url),console.dir(g);else console.error("Multiple professor links found for url: "+a.url),c()}else{var i=[],j=/[^\w\d\.\/%]/g;i[0]=k(f,'//*[@id="mainContent"]/div[1]/div[2]/div[1]/div/div[1]/div/div/div').replace(j,""),i[1]=k(f,'//*[@id="mainContent"]/div[1]/div[2]/div[1]/div/div[2]/div[1]/div').replace(j,""),i[2]=k(f,'//*[@id="mainContent"]/div[1]/div[2]/div[1]/div/div[2]/div[2]/div').replace(j,"");var l=document.evaluate('//*[@id="mainContent"]/div[1]/div[2]/div[1]/div/div[2]/div[3]/div/figure/img',f,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue.getAttribute("src");"new-hot-chili.png"==l?i[3]="Yes":i[3]=!1;for(var m={tags:[]},n=f.getElementsByClassName("tag-box-choosetags"),o=0;o<n.length;o++)m.tags.push(n[o].textContent.trim());i[4]=m,b>0&&console.dir(i),c(i)}}},d.send(),!0});